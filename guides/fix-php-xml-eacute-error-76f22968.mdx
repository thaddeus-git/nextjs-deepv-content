---
title: "Fix PHP XML 'undefined entity' Error with É Characters"
slug: "fix-php-xml-eacute-error"
category: "programming-languages"
subcategory: "php"
description: "Learn how to resolve 'undefined entity' errors in PHP XML parsing when dealing with HTML entities like &Eacute;."
tags: ["php","xml","html-entities","character-encoding","htmlspecialchars"]
difficulty: "beginner"
readTime: 5
lastUpdated: "2025-09-22T16:16:54.232Z"
featured: false
---

# Fix PHP XML 'undefined entity' Error with É Characters

When working with PHP and XML, encountering an "undefined entity" error, especially with characters like `&Eacute;`, is a common issue. This typically happens because HTML entities are not inherently valid in XML documents unless explicitly defined.

## Quick Answer

The most straightforward solution is to use `htmlspecialchars()` instead of `htmlentities()` when preparing data for XML. This function converts only the predefined XML entities (`&`, `<`, `>`, `"`, `'`), ensuring your XML remains well-formed.

```php
<?php
// Instead of:
// htmlentities($row['companys'], ENT_QUOTES);

// Use:
$xml_safe_string = htmlspecialchars($row['companys'], ENT_QUOTES | ENT_XML1, 'UTF-8');
echo "<Name>" . $xml_safe_string . "</Name>";
?>
```

## Choose Your Method

Deciding how to handle special characters in XML depends on your specific needs:

```mermaid
graph TD
    A[Start: XML Parsing Error: undefined entity?] --> B{Is the entity an HTML-specific one like &Eacute;?};
    B -- Yes --> C{Do you need to preserve the character as a readable entity?};
    C -- No, just the character --> D[Use htmlspecialchars() for XML output];
    D --> E[Ensure correct character encoding (e.g., UTF-8) in XML declaration];
    C -- Yes, as an entity --> F{Can you use numeric character references (e.g., &#201;)?};
    F -- Yes --> G[Convert to numeric character reference];
    F -- No, must be named entity --> H{Can you define the entity in a DTD/Schema?};
    H -- Yes --> I[Define custom entity in DTD/Schema];
    H -- No --> J[Consider if XML is the right format or if HTML output is intended];
    B -- No, it's a standard XML entity --> K[Check for malformed XML or incorrect encoding];
    E --> L[End];
    G --> L;
    I --> L;
    J --> L;
    K --> L;
```

## Working with XML Entities in PHP

The core of the problem lies in the difference between HTML and XML entity sets. HTML defines a vast array of named entities (like `&Eacute;` for `É`), while XML only predefines five: `&amp;`, `&lt;`, `&gt;`, `&quot;`, and `&apos;`. Any other named entity will cause an "undefined entity" error unless explicitly declared in a Document Type Definition (DTD) or XML Schema.

### Method 1: Using `htmlspecialchars()` for XML Output

This is the recommended approach for most scenarios where you want to embed text containing special characters into an XML document. `htmlspecialchars()` converts only the five predefined XML entities, leaving other characters as their literal (UTF-8) representation, which XML parsers can handle correctly if the encoding is specified.

```php
<?php
$companyName = "secret CAKES & CAFÉ limited";

// Correct usage for XML:
// ENT_XML1 ensures that quotes are converted to &apos; and &quot;
// UTF-8 is the recommended encoding for modern XML
$xmlSafeCompanyName = htmlspecialchars($companyName, ENT_QUOTES | ENT_XML1, 'UTF-8');

echo "<Name>" . $xmlSafeCompanyName . "</Name>";
// Expected output: <Name>secret CAKES &amp; CAFÉ limited</Name>
?>
```
In the output, `&` is converted to `&amp;`, but `É` remains `É`. This is perfectly valid XML, provided your XML document specifies a compatible encoding (like UTF-8).

### Method 2: Converting to Numeric Character References

If you specifically need to represent characters like `É` as entities within XML, but without defining custom entities, you can convert them to numeric character references (NCRs). For `É`, the NCR is `&#201;` (decimal) or `&#xC9;` (hexadecimal).

PHP's `htmlentities()` function, when used with specific flags, can convert all applicable characters to NCRs.

```php
<?php
$companyName = "secret CAKES & CAFÉ limited";

// Convert all applicable characters to named or numeric entities
// ENT_QUOTES for single/double quotes
// ENT_HTML5 for HTML5 entities (includes more than XML)
// ENT_SUBSTITUTE for replacing invalid characters
$htmlEntitiesCompanyName = htmlentities($companyName, ENT_QUOTES | ENT_HTML5 | ENT_SUBSTITUTE, 'UTF-8');

echo "<Name>" . $htmlEntitiesCompanyName . "</Name>";
// This would output: <Name>secret CAKES &amp; CAF&Eacute; limited</Name>
// This is still problematic for XML because &Eacute; is not a predefined XML entity.

// To get numeric entities for XML, you might need a custom function or careful flag usage.
// A more robust approach for XML is to ensure UTF-8 and use htmlspecialchars.
// If you *must* have NCRs for non-predefined XML characters, you'd typically do this:
$ncrCompanyName = mb_encode_numericentity($companyName, [0x80, 0x10FFFF, 0, 0x10FFFF], 'UTF-8');
echo "<Name>" . htmlspecialchars($ncrCompanyName, ENT_QUOTES | ENT_XML1, 'UTF-8') . "</Name>";
// Expected output: <Name>secret CAKES &amp; CAF&#xC9; limited</Name>
?>
```
The `mb_encode_numericentity` function is more suitable for converting specific character ranges to NCRs for XML.

### Method 3: Defining Custom Entities in a DTD

For advanced scenarios where you have control over the XML schema and need to use named HTML entities, you can define them in a Document Type Definition (DTD). This makes the XML document valid according to its DTD.

```xml
<!DOCTYPE root [
  <!ENTITY Eacute "&#201;">
]>
<root>
  <Name>secret CAKES &amp; CAF&Eacute; limited</Name>
</root>
```
However, this approach adds complexity and is generally not recommended for simple data exchange, as it requires all consumers of your XML to be aware of and validate against your DTD.

## Common Problems & Solutions

### Problem: XML Parsing Error: undefined entity
**Cause:** Using HTML named entities (like `&Eacute;`) directly in an XML document without defining them in a DTD.
**Solution:**
1. **Preferred:** Use `htmlspecialchars()` with `ENT_XML1` flag to convert only the 5 predefined XML entities. Ensure your XML document is encoded in UTF-8.
2. **Alternative:** Convert non-predefined entities to numeric character references (e.g., `&#201;`).

### Problem: Incorrect Character Display
**Cause:** Mismatch between the character encoding of your PHP script, your database, and the XML document's declared encoding.
**Solution:**
1. **Consistency:** Always use UTF-8 throughout your application (database, PHP files, XML declaration).
2. **XML Declaration:** Ensure your XML document starts with an encoding declaration: `<?xml version="1.0" encoding="UTF-8"?>`.

### Problem: `htmlentities()` still causing issues
**Cause:** `htmlentities()` converts *all* applicable characters to HTML entities, which are not all valid in XML.
**Solution:** For XML output, `htmlspecialchars()` is almost always the correct choice. Only use `htmlentities()` if you are specifically generating HTML, not XML.

## Real-World Use Cases

Consider a scenario where you're generating an XML feed (e.g., for products or articles) from a database. Product names or descriptions might contain special characters.

**Incorrect Approach (will cause XML error):**
```php
<?php
$productName = "T-shirt for Kids & Babies (Édition Limitée)";
$xmlOutput = "<product><name>" . htmlentities($productName, ENT_QUOTES, 'UTF-8') . "</name></product>";
// Output: <product><name>T-shirt for Kids &amp; Babies (&Eacute;dition Limit&eacute;e)</name></product>
// This will fail XML parsing due to &Eacute; and &eacute;
?>
```

**Correct Approach (using `htmlspecialchars`):**
```php
<?php
$productName = "T-shirt for Kids & Babies (Édition Limitée)";
$xmlOutput = "<product><name>" . htmlspecialchars($productName, ENT_QUOTES | ENT_XML1, 'UTF-8') . "</name></product>";
// Output: <product><name>T-shirt for Kids &amp; Babies (Édition Limitée)</name></product>
// This is valid XML, assuming the XML document is UTF-8 encoded.
?>
```
![XML Encoding Flowchart](PLACEHOLDER: XML Encoding Flowchart - /images/5491ccbc-1.webp)

## Summary

The "undefined entity" error in PHP XML parsing, particularly with characters like `É`, stems from the fundamental difference between HTML and XML entity sets. While `&Eacute;` is a valid HTML named entity, it is not a predefined XML entity.

The most robust and recommended solution is to use `htmlspecialchars()` with the `ENT_XML1` flag when preparing data for XML output. This function correctly escapes only the five predefined XML entities (`&`, `<`, `>`, `"`, `'`), leaving other characters (like `É`) as their literal UTF-8 representation, which is perfectly valid in a UTF-8 encoded XML document. Always ensure consistent UTF-8 encoding across your application to avoid character display issues.

---

## Image Generation Prompts

**PLACEHOLDER-1:** A flowchart illustrating the decision process for handling special characters in PHP for XML output.
- **Start:** "Data with Special Characters"
- **Decision 1:** "Outputting to HTML or XML?"
    - **Path 1 (HTML):** "Use `htmlentities()`"
    - **Path 2 (XML):** "Use `htmlspecialchars()`"
- **Decision 2 (from `htmlspecialchars()` path):** "Need to preserve specific named HTML entities (e.g., `&Eacute;`)?"
    - **Path 2a (No):** "Ensure UTF-8 encoding in XML declaration. Literal characters are fine."
    - **Path 2b (Yes):** "Convert to Numeric Character References (e.g., `&#201;`) OR Define custom entities in DTD (Advanced)."
- **End:** "Valid Output"
- **Style:** Clean, modern flowchart with clear arrows and labels. Use PHP and XML logos/icons where appropriate.